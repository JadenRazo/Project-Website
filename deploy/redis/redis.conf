# Redis Security Configuration for Portfolio Website
# This configuration prioritizes security over performance

# Network Security - CRITICAL
bind 127.0.0.1 ::1              # Only bind to localhost (IPv4 and IPv6)
protected-mode yes              # Enable protected mode
port 0                         # Disable default port
unixsocket /var/run/redis/redis.sock  # Use Unix socket instead
unixsocketperm 770             # Restrict socket permissions

# Authentication
requirepass ${REDIS_PASSWORD}  # Strong password required (will be replaced by env var)

# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG ""
rename-command SHUTDOWN ""
rename-command DEBUG ""
rename-command SAVE ""
rename-command BGSAVE ""
rename-command BGREWRITEAOF ""
rename-command SLAVEOF ""
rename-command REPLICAOF ""
rename-command MODULE ""
rename-command MONITOR ""
rename-command CLIENT ""

# Security settings
maxmemory-policy allkeys-lru    # Eviction policy for cache
maxmemory 512mb                 # Memory limit
timeout 300                     # Client timeout (5 minutes)
tcp-keepalive 60               # TCP keepalive
tcp-backlog 511                # TCP listen backlog

# Persistence (disabled for cache usage)
save ""                        # Disable RDB snapshots
appendonly no                  # Disable AOF
stop-writes-on-bgsave-error no

# Logging
logfile /var/log/redis/redis.log
loglevel notice
syslog-enabled yes
syslog-ident redis

# Slow log configuration
slowlog-log-slower-than 10000  # Log queries slower than 10ms
slowlog-max-len 128

# Latency monitoring
latency-monitor-threshold 100

# Advanced security
enable-protected-configs yes
enable-debug-command no
enable-module-command no

# Performance tuning for security
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# Disable Lua debugging
lua-debugging no

# Connection limits
maxclients 100

# Command statistics
commandstats-enabled yes